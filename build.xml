<?xml version="1.0"?>
<project name="TrekBuddy" default="standard" basedir=".">

    <property file="${include.properties}" prefix="external."/>
    <property file="build.properties"/>

    <property name="name" value="${external.product.name}"/>
    <property name="version" value="${external.product.version}"/>
    <property name="description" value="${external.product.description}"/>
    <property name="vendor" value="${external.product.vendor}"/>
    <property name="vendor.dir" value="${external.vendor.dir}"/>
    <property name="pre.extra" value="${external.pre.extra},__MARKSUPPORT__"/>

    <property name="wtk.cldc.version" value="1.1"/>
    <property name="wtk.midp.version" value="2.0"/>

    <property name="permission.attribute" value="MIDlet-Permissions-Opt"/>

    <property name="wtk.home" value="c:\J2ME\WTK2.5.2_01"/>
    <property name="wtk3.home" value="c:\J2ME\JavaME3.0"/>
    <property name="motorola.home" value="c:\J2ME\Motorola\SDKv6.2\EmulatorM.3"/>
    <property name="garnet.home" value="c:\J2ME\Garnet\PalmOS JVM 5.7.2\Tools"/>
    <property name="rim41.home" value="c:\J2ME\RIM\JDE 4.1.0"/>
    <property name="rim42.home" value="c:\J2ME\RIM\JDE 4.2.1"/>
    <property name="rim50.home" value="c:\J2ME\RIM\JDE 5.0"/>
    <property name="android.home" value="c:\J2ME\android-sdk-windows"/>
    <property name="android15.home" value="c:\J2ME\android-sdk-windows\platforms\android-1.5"/>
    <property name="android16.home" value="c:\J2ME\android-sdk-windows\platforms\android-1.6"/>
    <property name="android20.home" value="c:\J2ME\android-sdk-windows\platforms\android-2.0"/>
    <property name="androidant.home" value="c:\J2ME\android-sdk-ant"/>
    <property name="microemu.home" value="z:\repository\microemu-google\microemulator"/>
    <property name="cn1.home" value="z:\apps\Codename One"/>
    <property name="cn1.repository" value="z:\repository\cn1\CodenameOne"/>
    <property name="proguard3.home" value="z:\apps\proguard\3.11"/>
    <property name="proguard4.home" value="z:\apps\proguard\4.11"/>
    <property name="proguard5.home" value="z:\apps\proguard\5.1"/>

    <property name="build.dir" value="r:\trekbuddy"/>
    <property name="temp.dir" value="r:\java-temp"/>

    <property name="use.proguard" value="3"/>

    <taskdef resource="antenna.properties" classpath="lib/antenna-bin-1.0.2.jar"/>
    <taskdef name="otaJad" classname="RimOtaJadSha" classpath="${basedir}/tools/classes"/>
    <taskdef name="barManifest" classname="BarManifestVersion" classpath="${basedir}/tools/classes"/>
    <taskdef name="buildVersion" classname="BuildVersion" classpath="${basedir}/tools/classes"/>

    <path id="bootclasspath.standard">
        <pathelement location="${wtk.home}\lib\cldcapi11.jar"/>
        <pathelement location="${wtk.home}\lib\midpapi20.jar"/>
        <pathelement location="${wtk.home}\lib\jsr75.jar"/>
        <pathelement location="${wtk.home}\lib\jsr082.jar"/>
        <pathelement location="${wtk.home}\lib\jsr179.jar"/>
        <pathelement location="${wtk.home}\lib\jsr234.jar"/>
        <pathelement location="${wtk.home}\lib\wma11.jar"/>
        <pathelement location="${wtk.home}\lib\mmapi.jar"/>
        <pathelement location="lib\lg-mmpp.jar"/>
        <pathelement location="lib\motorola-ext.jar"/>
        <pathelement location="lib\motorola-file.jar"/>
        <pathelement location="lib\motorola-location.jar"/>
        <pathelement location="lib\motorola-javaextensions.jar"/>
        <pathelement location="lib\nokia-ui-devicecontrol.jar"/>
        <pathelement location="lib\siemens-file.jar"/>
        <pathelement location="lib\siemens-game.jar"/>
        <pathelement location="lib\samsung-apis.jar"/>
        <pathelement location="lib\SonimLibrary.jar"/>
    </path>

    <path id="bootclasspath.symbian">
        <pathelement location="${wtk.home}\lib\cldcapi11.jar"/>
        <pathelement location="${wtk.home}\lib\midpapi20.jar"/>
        <pathelement location="${wtk.home}\lib\jsr75.jar"/>
        <pathelement location="${wtk.home}\lib\jsr082.jar"/>
        <pathelement location="${wtk.home}\lib\jsr179.jar"/>
        <pathelement location="${wtk.home}\lib\jsr234.jar"/>
        <pathelement location="${wtk.home}\lib\wma11.jar"/>
        <pathelement location="${wtk.home}\lib\mmapi.jar"/>
        <pathelement location="lib\nokia-ui-devicecontrol.jar"/>
        <pathelement location="lib\nokia-iapinfo.jar"/>
    </path>

    <path id="bootclasspath.std">
        <pathelement location="${wtk.home}\lib\cldcapi11.jar"/>
        <pathelement location="${wtk.home}\lib\midpapi20.jar"/>
        <pathelement location="${wtk.home}\lib\jsr75.jar"/>
        <pathelement location="${wtk.home}\lib\jsr082.jar"/>
        <pathelement location="${wtk.home}\lib\jsr179.jar"/>
        <pathelement location="${wtk.home}\lib\jsr234.jar"/>
        <pathelement location="${wtk.home}\lib\wma11.jar"/>
        <pathelement location="${wtk.home}\lib\mmapi.jar"/>
    </path>

    <path id="bootclasspath.android20">
        <pathelement location="${microemu.home}\microemu-cldc\target\microemu-cldc-3.0.0-SNAPSHOT.jar"/>
        <pathelement location="${microemu.home}\microemu-midp\target\microemu-midp-3.0.0-SNAPSHOT.jar"/>
        <pathelement location="${microemu.home}\microemu-extensions\microemu-jsr-75\target\microemu-jsr-75-3.0.0-SNAPSHOT.jar"/>
        <pathelement location="${microemu.home}\microemu-android\microemu-android-ant.jar"/>
        <pathelement location="${android20.home}\android.jar"/>
        <pathelement location="${androidant.home}\lib\antlib.jar"/>
        <pathelement location="${microemu.home}\microemu-android\antplus_demo.jar"/>
    </path>

    <path id="bootclasspath.android16">
        <pathelement location="${microemu.home}\microemu-cldc\target\microemu-cldc-3.0.0-SNAPSHOT.jar"/>
        <pathelement location="${microemu.home}\microemu-midp\target\microemu-midp-3.0.0-SNAPSHOT.jar"/>
        <pathelement location="${microemu.home}\microemu-extensions\microemu-jsr-75\target\microemu-jsr-75-3.0.0-SNAPSHOT.jar"/>
        <pathelement location="${microemu.home}\microemu-android\microemu-android-ant.jar"/>
        <pathelement location="${android16.home}\android.jar"/>
        <pathelement location="${androidant.home}\lib\antlib.jar"/>
        <pathelement location="${microemu.home}\microemu-android\antplus_demo.jar"/>
        <pathelement location="${microemu.home}\microemu-android\lib\backport-android-bluetooth2.jar"/>
    </path>

    <path id="bootclasspath.rim41">
        <pathelement location="${rim41.home}\lib\net_rim_api.jar"/>
    </path>

    <path id="bootclasspath.rim42">
        <pathelement location="${rim42.home}\lib\net_rim_api.jar"/>
    </path>

    <path id="bootclasspath.rim50">
        <pathelement location="${rim50.home}\lib\net_rim_api.jar"/>
    </path>

    <path id="bootclasspath.cn1">
        <pathelement location="${cn1.home}\lib\CLDC11.jar"/>
        <pathelement location="${cn1.home}\lib\CodenameOne.jar"/>
    </path>

    <path id="bootclasspath.cn1-trunk">
        <pathelement location="${cn1.repository}\CLDC11.jar"/>
        <pathelement location="${cn1.repository}\dist\CodenameOne.jar"/>
    </path>

    <path id="bootclasspath.emulator">
        <pathelement location="${wtk.home}\lib\cldcapi11.jar"/>
        <pathelement location="${wtk.home}\lib\midpapi20.jar"/>
        <pathelement location="${wtk.home}\lib\jsr75.jar"/>
        <pathelement location="${wtk.home}\lib\jsr082.jar"/>
        <pathelement location="${wtk.home}\lib\jsr179.jar"/>
        <pathelement location="${wtk.home}\lib\jsr234.jar"/>
        <pathelement location="${wtk.home}\lib\wma11.jar"/>
        <pathelement location="${wtk.home}\lib\mmapi.jar"/>
        <!--
        <pathelement location="lib\lg-mmpp.jar"/>
        <pathelement location="lib\motorola-ext.jar"/>
        <pathelement location="lib\motorola-file.jar"/>
        <pathelement location="lib\motorola-location.jar"/>
        <pathelement location="lib\motorola-javaextensions.jar"/>
        <pathelement location="lib\nokia-ui-devicecontrol.jar"/>
        <pathelement location="lib\siemens-file.jar"/>
        <pathelement location="lib\siemens-game.jar"/>
        <pathelement location="lib\samsung-apis.jar"/>
        -->
    </path>

    <target name="standard">
        <property name="suffix" value=""/>
        <property name="dist.dir" value="standard"/>
        <property name="libraryjars" value="${wtk.home}\lib\cldcapi11.jar;${wtk.home}\lib\midpapi20.jar;${wtk.home}\lib\jsr75.jar;${wtk.home}\lib\jsr082.jar;${wtk.home}\lib\jsr179.jar;${wtk.home}\lib\jsr234.jar;${wtk.home}\lib\wma11.jar;${wtk.home}\lib\mmapi.jar;lib\lg-mmpp.jar;lib\motorola-ext.jar;lib\motorola-file.jar;lib\motorola-javaextensions.jar;lib\motorola-location.jar;lib\nokia-ui-devicecontrol.jar;lib\siemens-file.jar;lib\siemens-game.jar;lib\samsung-apis.jar"/> <!-- same as bootclasspath -->
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.standard"/>
        <antcall target="compile.standard"/>
        <antcall target="a.pack" inheritall="true"/>
        <antcall target="obfuscate${use.proguard}" inheritall="true"/>
        <antcall target="preverify" inheritall="true"/>
        <antcall target="dist" inheritall="true"/>
        <antcall target="sign.and.update" inheritall="true"/>
    </target>

    <target name="standard-lite">
        <property name="suffix" value="-lite"/>
        <property name="dist.dir" value="standard-lite"/>
        <property name="libraryjars" value="${wtk.home}\lib\cldcapi11.jar;${wtk.home}\lib\midpapi20.jar;${wtk.home}\lib\jsr75.jar;${wtk.home}\lib\jsr082.jar;${wtk.home}\lib\jsr179.jar;${wtk.home}\lib\jsr234.jar;${wtk.home}\lib\wma11.jar;${wtk.home}\lib\mmapi.jar;lib\motorola-location.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.standard-lite"/>
        <antcall target="compile.standard-lite"/>
        <antcall target="lite.pack" inheritall="true"/>
        <antcall target="obfuscate${use.proguard}" inheritall="true"/>
        <antcall target="preverify" inheritall="true"/>
        <antcall target="dist" inheritall="true"/>
        <antcall target="sign.and.update" inheritall="true"/>
    </target>

    <target name="b2b-lite">
        <property name="suffix" value=""/>
        <property name="dist.dir" value="b2b-lite"/>
        <property name="libraryjars" value="${wtk.home}\lib\cldcapi11.jar;${wtk.home}\lib\midpapi20.jar;${wtk.home}\lib\jsr75.jar;${wtk.home}\lib\jsr082.jar;${wtk.home}\lib\jsr179.jar;${wtk.home}\lib\jsr234.jar;${wtk.home}\lib\wma11.jar;${wtk.home}\lib\mmapi.jar;lib\motorola-location.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.b2b-lite"/>
        <antcall target="compile.standard-lite"/>
        <antcall target="lite.pack" inheritall="true"/>
        <antcall target="obfuscate${use.proguard}" inheritall="true"/>
        <antcall target="preverify" inheritall="true"/>
        <antcall target="dist" inheritall="true"/>
        <antcall target="sign.and.update" inheritall="true"/>
    </target>

    <target name="b2b-builder">
        <property name="suffix" value="-builder"/>
        <property name="dist.dir" value="b2b-builder"/>
        <property name="libraryjars" value="${wtk.home}\lib\cldcapi11.jar;${wtk.home}\lib\midpapi20.jar;${wtk.home}\lib\jsr75.jar;${wtk.home}\lib\jsr082.jar;${wtk.home}\lib\jsr179.jar;${wtk.home}\lib\jsr234.jar;${wtk.home}\lib\wma11.jar;${wtk.home}\lib\mmapi.jar;lib\motorola-location.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.b2b-builder"/>
        <antcall target="compile.standard-lite"/>
        <antcall target="lite.pack" inheritall="true"/>
        <antcall target="obfuscate${use.proguard}" inheritall="true"/>
        <antcall target="preverify" inheritall="true"/>
        <antcall target="dist" inheritall="true"/>
        <antcall target="sign.and.update" inheritall="true"/>
    </target>

    <target name="basic">
        <property name="suffix" value="-basic"/>
        <property name="dist.dir" value="basic"/>
        <property name="libraryjars" value="${wtk.home}\lib\cldcapi11.jar;${wtk.home}\lib\midpapi20.jar;${wtk.home}\lib\jsr75.jar;${wtk.home}\lib\jsr082.jar;${wtk.home}\lib\jsr179.jar;${wtk.home}\lib\jsr234.jar;${wtk.home}\lib\wma11.jar;${wtk.home}\lib\mmapi.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.std"/>
        <antcall target="compile.std"/>
        <antcall target="a.pack" inheritall="true"/>
        <antcall target="obfuscate${use.proguard}" inheritall="true"/>
        <antcall target="preverify" inheritall="true"/>
        <antcall target="dist" inheritall="true"/>
        <antcall target="sign.and.update" inheritall="true"/>
    </target>

    <target name="symbian">
        <property name="suffix" value="-symbian"/>
        <property name="dist.dir" value="symbian"/>
        <property name="libraryjars" value="${wtk.home}\lib\cldcapi11.jar;${wtk.home}\lib\midpapi20.jar;${wtk.home}\lib\jsr75.jar;${wtk.home}\lib\jsr082.jar;${wtk.home}\lib\jsr179.jar;${wtk.home}\lib\jsr234.jar;${wtk.home}\lib\wma11.jar;${wtk.home}\lib\mmapi.jar;lib\nokia-ui-devicecontrol.jar;lib\nokia-iapinfo.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.symbian"/>
        <antcall target="compile.symbian"/>
        <antcall target="symbian.pack" inheritall="true"/>
        <antcall target="obfuscate${use.proguard}" inheritall="true"/>
        <antcall target="preverify" inheritall="true"/>
        <antcall target="dist.symbian" inheritall="true"/>
        <antcall target="sign.and.update" inheritall="true"/>
    </target>

    <target name="j9">
        <property name="suffix" value="-j9"/>
        <property name="dist.dir" value="j9"/>
        <property name="libraryjars" value="${wtk.home}\lib\cldcapi11.jar;${wtk.home}\lib\midpapi20.jar;${wtk.home}\lib\jsr75.jar;${wtk.home}\lib\jsr082.jar;${wtk.home}\lib\jsr179.jar;${wtk.home}\lib\jsr234.jar;${wtk.home}\lib\wma11.jar;${wtk.home}\lib\mmapi.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.j9"/>
        <antcall target="compile.std"/>
        <antcall target="j9.pack" inheritall="true"/>
        <antcall target="obfuscate${use.proguard}" inheritall="true"/>
        <antcall target="preverify" inheritall="true"/>
        <antcall target="dist" inheritall="true"/>
        <antcall target="sign.and.update" inheritall="true"/>
        <!-- make PRC right away -->
        <antcall target="jad2prc"/>
    </target>

    <!--target name="rim41">
        <property name="suffix" value="_bb_os41"/>
        <property name="dist.dir" value="rim41"/>
        <property name="rim.home" value="${rim41.home}"/>
        <property name="libraryjars" value="${rim41.home}\lib\net_rim_api.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <property name="rim.cod.dependencies" value="net_rim_cldc,net_rim_os,net_rim_locationapi"/>
        <property name="rim.bb.version" value="[4.1,4.2)"/>
        <antcall target="clean"/>
        <antcall target="a.pre.rim"/>
        <antcall target="compile.rim41"/>
        <antcall target="rim.pack" inheritall="true"/>
        <antcall target="obfuscate${use.proguard}.rim" inheritall="true"/>
        <antcall target="rim.preverify" inheritall="true"/>
        <antcall target="dist" inheritall="true"/>
        <antcall target="rim.rapc" inheritall="true"/>
        <antcall target="rim.sign" inheritall="true"/>
        <antcall target="rim.ota" inheritall="true"/>
    </target-->

    <target name="rim42">
        <property name="suffix" value="_bb_os42"/>
        <property name="dist.dir" value="rim42"/>
        <property name="rim.home" value="${rim42.home}"/>
        <property name="libraryjars" value="${rim42.home}\lib\net_rim_api.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <property name="rim.cod.dependencies" value="net_rim_cldc,net_rim_locationapi,net_rim_bluetooth"/>
        <property name="rim.bb.version" value="[4.2,5.0)"/>
        <antcall target="clean"/>
        <antcall target="a.pre.rim"/>
        <antcall target="compile.rim42"/>
        <antcall target="rim.pack" inheritall="true">
            <param name="resource.folder" value="res-RIM"/>
        </antcall>
        <antcall target="obfuscate${use.proguard}.rim" inheritall="true"/>
        <antcall target="rim.preverify" inheritall="true"/>
        <antcall target="dist" inheritall="true"/>
        <antcall target="rim.rapc" inheritall="true"/>
        <antcall target="rim.sign" inheritall="true"/>
        <antcall target="rim.ota" inheritall="true"/>
    </target>

    <target name="rim50">
        <property name="suffix" value="_bb_os50"/>
        <property name="dist.dir" value="rim50"/>
        <property name="rim.home" value="${rim50.home}"/>
        <property name="libraryjars" value="${rim50.home}\lib\net_rim_api.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <property name="rim.cod.dependencies" value="net_rim_cldc,net_rim_locationapi,net_rim_bluetooth"/>
        <property name="rim.bb.version" value="[5.0,)"/>
        <antcall target="clean"/>
        <antcall target="a.pre.rim50"/>
        <antcall target="compile.rim50-ng"/>
        <antcall target="rim.pack" inheritall="true">
            <param name="resource.folder" value="res-RIM50"/>
        </antcall>
        <antcall target="obfuscate${use.proguard}.rim" inheritall="true"/>
        <antcall target="rim.preverify" inheritall="true"/>
        <antcall target="dist" inheritall="true"/>
        <antcall target="rim.rapc" inheritall="true"/>
        <antcall target="rim.sign" inheritall="true"/>
        <antcall target="rim.ota" inheritall="true"/>
    </target>

    <target name="android">
        <property name="suffix" value="-android"/>
        <property name="dist.dir" value="android"/>
        <property name="libraryjars" value="${microemu.home}\microemu-cldc\target\microemu-cldc-3.0.0-SNAPSHOT.jar;${microemu.home}\microemu-midp\target\microemu-midp-3.0.0-SNAPSHOT.jar;${microemu.home}\microemu-extensions\microemu-jsr-75\target\microemu-jsr-75-3.0.0-SNAPSHOT.jar;${android20.home}\android.jar;${microemu.home}\microemu-android\microemu-android-ant.jar;${androidant.home}\lib\antlib.jar;${microemu.home}\microemu-android\antplus_demo.jar"/>
        <antcall target="clean"/>
        <ant dir="${microemu.home}/microemu-android"
             antfile="build-trekbuddy.xml" target="clean"
             inheritAll="false" inheritRefs="false">
            <property name="target.version" value="any"/>
            <property name="sdk.version" value="2.2"/>
            <property name="api.level" value="10"/>
            <property name="dist.dir" value="android"/>
	    </ant>
        <antcall target="a.pre.android"/>
        <antcall target="compile.android"/>
        <antcall target="android.pack" inheritall="true"/>
        <antcall target="obfuscate4.android" inheritall="true"/>
<!-- not needed, so rename the jar as if it happened
        <antcall target="preverify" inheritall="true"/>
-->
        <move file="tmp/trekbuddy${suffix}-obfuscated.jar"
              tofile="tmp/preverified/trekbuddy${suffix}-obfuscated.jar"/>
        <antcall target="dist.android" inheritall="true"/>
        <ant dir="${microemu.home}/microemu-android"
             antfile="build-trekbuddy.xml" target="zipalign"
             inheritAll="false" inheritRefs="false">
            <property name="target.version" value="any"/>
            <property name="sdk.version" value="2.2"/>
            <property name="api.level" value="10"/>
            <property name="dist.dir" value="android"/>
            <property name="javac.debug" value="true"/>
            <property name="javac.debuglevel" value="source,lines"/>
            <!--
            <property name="do.obfuscate" value="true"/>
            -->
        </ant>
        <copy file="${microemu.home}/microemu-android/bin/trekbuddy.apk"
			  tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy.apk"/>
        <move file="dist/${vendor.dir}/${dist.dir}/trekbuddy-android.map"
              tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy.map"/>
    </target>

    <target name="android-offline">
        <property name="suffix" value="-android"/>
        <property name="dist.dir" value="android-offline"/>
        <property name="libraryjars" value="${microemu.home}\microemu-cldc\target\microemu-cldc-3.0.0-SNAPSHOT.jar;${microemu.home}\microemu-midp\target\microemu-midp-3.0.0-SNAPSHOT.jar;${microemu.home}\microemu-extensions\microemu-jsr-75\target\microemu-jsr-75-3.0.0-SNAPSHOT.jar;${android20.home}\android.jar;${microemu.home}\microemu-android\microemu-android-ant.jar;${androidant.home}\lib\antlib.jar;${microemu.home}\microemu-android\antplus_demo.jar"/>
        <antcall target="clean"/>
        <ant dir="${microemu.home}/microemu-android"
             antfile="build-trekbuddy.xml" target="clean"
             inheritAll="false" inheritRefs="false">
            <property name="target.version" value="any"/>
            <property name="sdk.version" value="2.2"/>
            <property name="api.level" value="10"/>
            <property name="dist.dir" value="android"/>
	    </ant>
        <antcall target="a.pre.android-offline"/>
        <antcall target="compile.android"/>
        <antcall target="android.pack" inheritall="true"/>
        <antcall target="obfuscate4.android" inheritall="true"/>
<!-- not needed, so rename the jar as if it happened
        <antcall target="preverify" inheritall="true"/>
-->
        <move file="tmp/trekbuddy${suffix}-obfuscated.jar"
              tofile="tmp/preverified/trekbuddy${suffix}-obfuscated.jar"/>
        <antcall target="dist.android" inheritall="true"/>
        <ant dir="${microemu.home}/microemu-android"
             antfile="build-trekbuddy.xml" target="zipalign"
             inheritAll="false" inheritRefs="false">
            <property name="target.version" value="any-offline"/>
            <property name="sdk.version" value="2.2"/>
            <property name="api.level" value="10"/>
            <property name="dist.dir" value="android-offline"/>
            <property name="javac.debug" value="true"/>
            <property name="javac.debuglevel" value="source,lines"/>
            <!--
            <property name="do.obfuscate" value="true"/>
            -->
        </ant>
        <copy file="${microemu.home}/microemu-android/bin/trekbuddy.apk"
			  tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy-offline.apk"/>
        <move file="dist/${vendor.dir}/${dist.dir}/trekbuddy-android.map"
              tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy-offline.map"/>
    </target>

    <target name="android-backport">
        <property name="suffix" value="-android"/>
        <property name="dist.dir" value="android-backport"/>
        <property name="libraryjars" value="${microemu.home}\microemu-cldc\target\microemu-cldc-3.0.0-SNAPSHOT.jar;${microemu.home}\microemu-midp\target\microemu-midp-3.0.0-SNAPSHOT.jar;${microemu.home}\microemu-extensions\microemu-jsr-75\target\microemu-jsr-75-3.0.0-SNAPSHOT.jar;${android20.home}\android.jar;${microemu.home}\microemu-android\lib\backport-android-bluetooth2.jar;${microemu.home}\microemu-android\microemu-android-ant.jar;${androidant.home}\lib\antlib.jar;${microemu.home}\microemu-android\antplus_demo.jar"/>
        <antcall target="clean"/>
        <ant dir="${microemu.home}/microemu-android"
             antfile="build-trekbuddy.xml" target="clean"
             inheritAll="false" inheritRefs="false">
            <property name="target.version" value="backport"/>
            <property name="sdk.version" value="1.6"/>
            <property name="api.level" value="4"/>
            <property name="dist.dir" value="android-backport"/>
        </ant>
        <antcall target="a.pre.android-backport"/>
        <antcall target="compile.android-backport"/>
        <antcall target="android.pack" inheritall="true"/>
        <antcall target="obfuscate4.android" inheritall="true"/>
<!-- not needed, so rename the jar as if it happened
        <antcall target="preverify" inheritall="true"/>
-->
        <move file="tmp/trekbuddy${suffix}-obfuscated.jar"
              tofile="tmp/preverified/trekbuddy${suffix}-obfuscated.jar"/>
        <antcall target="dist" inheritall="true"/>
        <ant dir="${microemu.home}/microemu-android"
             antfile="build-trekbuddy.xml" target="zipalign"
             inheritAll="false" inheritRefs="false">
            <property name="target.version" value="backport"/>
            <property name="sdk.version" value="1.6"/>
            <property name="api.level" value="4"/>
            <property name="dist.dir" value="android-backport"/>
            <property name="javac.debug" value="true"/>
            <property name="javac.debuglevel" value="source,lines"/>
            <property name="is.backport" value="true"/>
            <!--
            <property name="do.obfuscate" value="true"/>
            -->
        </ant>
        <copy file="${microemu.home}/microemu-android/bin/trekbuddy.apk"
			  tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy-backport.apk"/>
        <move file="dist/${vendor.dir}/${dist.dir}/trekbuddy-android.map"
              tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy-backport.map"/>
    </target>

    <target name="playbook">
        <delete includeemptydirs="true" verbose="true">
          <fileset dir="dist/${vendor.dir}/playbook" excludes="build.log"/>
        </delete>
        <copy file="dist\public\android\trekbuddy.apk" todir="dist\public\playbook"/>
        <java classname="net.rim.tools.apk2bar.Apk2BarVerifier"
              fork="true"
              failonerror="true"
              maxmemory="512m">
            <arg line="dist\public\playbook\trekbuddy.apk ${android.home}"/>
            <classpath>
                <pathelement location="${android.home}\lib\BARPackager.jar"/>
                <pathelement location="${android.home}\lib\Apk2Bar.jar"/>
                <!--pathelement location="${android.home}\lib\Apk2Bar-1.0.3.jar"/-->
            </classpath>
        </java>
        <java classname="net.rim.tools.apk2bar.Apk2Bar"
              fork="true"
              failonerror="true"
              maxmemory="512m">
            <arg line="dist\public\playbook\trekbuddy.apk ${android.home} -a kruch"/>
            <classpath>
                <pathelement location="${android.home}\lib\BARPackager.jar"/>
                <pathelement location="${android.home}\lib\Apk2Bar.jar"/>
                <!--pathelement location="${android.home}\lib\Apk2Bar-1.0.3.jar"/-->
            </classpath>
        </java>
        <unzip src="dist\public\playbook\trekbuddy.bar" dest="dist\public\playbook">
            <patternset>
                <include name="META-INF/MANIFEST.MF"/>
            </patternset>
        </unzip>
        <barManifest infile="dist\public\playbook\META-INF\MANIFEST.MF"
                     outfile="dist\public\playbook\trekbuddy.MF"
                     appVersion="${version}.0.${build_version}"/>
        <java classname="net.rim.tools.apk2bar.Apk2Bar"
              fork="true"
              failonerror="true"
              maxmemory="512m">
            <arg line="dist\public\playbook\trekbuddy.apk ${android.home} -m -a kruch"/>
            <classpath>
                <pathelement location="${android.home}\lib\BARPackager.jar"/>
                <pathelement location="${android.home}\lib\Apk2Bar.jar"/>
                <!--pathelement location="${android.home}\lib\Apk2Bar-1.0.3.jar"/-->
            </classpath>
        </java>
        <!--
        <input message="sign bar?" validargs="y,n" addproperty="do.sign.response"/>
        <condition property="do.sign">
            <equals arg1="n" arg2="${do.sign.response}"/>
        </condition>
        -->
    </target>

    <target name="playbook.signed">
        <mkdir dir="dist\public\playbook\ota"/>
        <java classname="net.rim.device.codesigning.barsigner.BarSigner"
              fork="true"
              failonerror="true"
              maxmemory="512m">
            <arg line="-storepass changeit -signedbar dist\public\playbook\ota\trekbuddy.bar -verbose dist\public\playbook\trekbuddy.bar"/>
            <classpath>
                <pathelement location="${android.home}\lib\EccpressoAll.jar"/>
                <pathelement location="${android.home}\lib\EccpressoJDK15ECC.jar"/>
                <pathelement location="${android.home}\lib\TrustpointAll.jar"/>
                <pathelement location="${android.home}\lib\BarSigner.jar"/>
                <pathelement location="${android.home}\lib\BarPackager.jar"/>
                <pathelement location="${android.home}\lib\KeyTool.jar"/>
            </classpath>
        </java>
    </target>

    <target name="cn1">
        <property name="suffix" value="-cn1"/>
        <property name="dist.dir" value="cn1"/>
        <property name="libraryjars" value="${cn1.home}\lib\CLDC11.jar;${cn1.home}\lib\CodenameOne.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.cn1"/>
        <antcall target="compile.cn1"/>
        <antcall target="cn1.pack" inheritall="true"/>
<!--
        <antcall target="obfuscate4.cn1" inheritall="true"/>
        <antcall target="preverify" inheritall="true"/>
-->
        <move file="tmp/trekbuddy${suffix}.jar"
              tofile="tmp/trekbuddy${suffix}-obfuscated.jar"/>
        <move file="tmp/trekbuddy${suffix}-obfuscated.jar"
              tofile="tmp/preverified/trekbuddy${suffix}-obfuscated.jar"/>
        <antcall target="dist" inheritall="true"/>
    </target>

    <target name="cn1-emulator">
        <property name="suffix" value="-cn1"/>
        <property name="dist.dir" value="cn1-emulator"/>
        <property name="libraryjars" value="${cn1.home}\lib\CLDC11.jar;${cn1.home}\lib\CodenameOne.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.cn1-emulator"/>
        <antcall target="compile.cn1"/>
        <antcall target="cn1.pack" inheritall="true"/>
<!--
        <antcall target="emulator.obfuscate" inheritall="true"/>
        <antcall target="preverify" inheritall="true"/>
-->
        <move file="tmp/trekbuddy${suffix}.jar"
              tofile="tmp/trekbuddy${suffix}-obfuscated.jar"/>
        <move file="tmp/trekbuddy${suffix}-obfuscated.jar"
              tofile="tmp/preverified/trekbuddy${suffix}-obfuscated.jar"/>
        <antcall target="dist" inheritall="true"/>
    </target>

    <target name="wp.full">
        <echo message="Use 'wp-shrinked' target!"/>
        <property name="suffix" value="-wp"/>
        <property name="dist.dir" value="wp"/>
        <property name="libraryjars" value="${cn1.repository}\CLDC11.jar;${cn1.repository}\dist\CodenameOne.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.cn1-nb"/>
        <antcall target="prepare.cn1-nb"/>
        <antcall target="compile.cn1-trunk"/>
        <antcall target="cn1-trunk.pack"/>
        <!-- creates shrinked CN1 dist -->
        <antcall target="wp.pack"/>
        <antcall target="obfuscate5.wp" inheritall="true"/>
        <antcall target="wp.repack"/>
    </target>

    <target name="wp-shrinked">
        <property name="suffix" value="-wp"/>
        <property name="dist.dir" value="wp"/>
        <property name="libraryjars" value="${cn1.repository}\CLDC11.jar;${cn1.repository}\dist\CodenameOne-shrinked.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.cn1-nb"/>
        <antcall target="prepare.cn1-nb"/>
        <antcall target="compile.cn1-trunk"/>
        <antcall target="cn1-trunk.pack"/>
    </target>

    <target name="wp-nolog">
        <property name="suffix" value="-wp"/>
        <property name="dist.dir" value="wp"/>
        <property name="libraryjars" value="${cn1.repository}\CLDC11.jar;${cn1.repository}\dist\CodenameOne.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.cn1-nb-nolog"/>
        <antcall target="prepare.cn1-nb"/>
        <antcall target="compile.cn1-trunk"/>
        <antcall target="cn1-trunk.pack"/>
    </target>

    <target name="emulator">
        <property name="suffix" value="-emulator"/>
        <property name="dist.dir" value="emulator"/>
        <property name="libraryjars" value="${wtk.home}\lib\cldcapi11.jar;${wtk.home}\lib\midpapi20.jar;${wtk.home}\lib\jsr75.jar;${wtk.home}\lib\jsr082.jar;${wtk.home}\lib\jsr179.jar;${wtk.home}\lib\jsr234.jar;${wtk.home}\lib\wma11.jar;${wtk.home}\lib\mmapi.jar"/>
        <property name="classpath.preverify" value="${libraryjars}"/>
        <antcall target="clean"/>
        <antcall target="a.pre.emulator"/>
        <antcall target="compile.emulator"/>
        <antcall target="a.pack" inheritall="true"/>
<!--
        <antcall target="emulator.obfuscate" inheritall="true"/>
-->
        <move file="tmp/trekbuddy${suffix}.jar"
              tofile="tmp/trekbuddy${suffix}-obfuscated.jar"/>
        <antcall target="preverify" inheritall="true"/>
<!--    // WTK emulator requires preverified code
        <move file="tmp/trekbuddy${suffix}-obfuscated.jar"
              tofile="tmp/preverified/trekbuddy${suffix}-obfuscated.jar"/>
-->
        <antcall target="dist" inheritall="true"/>
    </target>

    <target name="clean">
        <delete dir="tmp"/>
        <delete includeemptydirs="true" verbose="true">
          <fileset dir="dist/${vendor.dir}/${dist.dir}" includes="**/trekbuddy*" excludes="build.log"/>
        </delete>
        <echo/>
        <echo>Prepared for bulding ${version} version in dist/${vendor.dir}/${dist.dir}</echo>
        <echo/>
        <echo>************************************************************</echo>
        <echo>*** Vendor:       ${vendor}</echo>
        <echo>*** Version:      ${version}</echo>
        <echo>*** Distribution: ${dist.dir}</echo>
        <echo>*** Suffix:       ${suffix}</echo>
        <echo>*** Properties:   ${include.properties}</echo>
        <echo>*** Extra Prep:   ${pre.extra}</echo>
        <echo>*** Vendor Dir:   ${vendor.dir}</echo>
        <echo>*** Locale:       ${locale} (ignored)</echo>
        <echo>************************************************************</echo>
        <echo/>
    </target>

    <target name="a.pre.hecl">
<!--
        <ant antfile="hecl.xml" target="compile"/>
-->
        <wtkpreprocess srcdir="hecl-core" destdir="tmp/src" version="2"
                       symbols="j2me=1,cldc=${wtk.cldc.version},midp=${wtk.midp.version},javaversion=1.2"/>
        <wtkpreprocess srcdir="hecl-net" destdir="tmp/src" version="2"
                       symbols="j2me=1,cldc=${wtk.cldc.version},midp=${wtk.midp.version},javaversion=1.2"/>
        <delete file="tmp/src/org/hecl/PrintThing.java" verbose="true"/>
        <delete file="tmp/src/org/hecl/PutsCmd.java" verbose="true"/>
    </target>

    <target name="a.pre.hecl-android">
<!--
        <ant antfile="hecl.xml" target="compile"/>
-->
        <wtkpreprocess srcdir="hecl-core" destdir="tmp/src" version="2"
                       symbols="j2me=1,cldc=${wtk.cldc.version},midp=${wtk.midp.version},javaversion=1.2,android=1"/>
        <wtkpreprocess srcdir="hecl-net" destdir="tmp/src" version="2"
                       symbols="j2me=1,cldc=${wtk.cldc.version},midp=${wtk.midp.version},javaversion=1.2,android=1"/>
        <delete file="tmp/src/org/hecl/PrintThing.java" verbose="true"/>
        <delete file="tmp/src/org/hecl/PutsCmd.java" verbose="true"/>
    </target>

    <target name="a.pre.hecl-android-offline">
<!--
        <ant antfile="hecl.xml" target="compile"/>
-->
        <wtkpreprocess srcdir="hecl-core" destdir="tmp/src" version="2"
                       symbols="j2me=1,cldc=${wtk.cldc.version},midp=${wtk.midp.version},javaversion=1.2,android=1"/>
        <delete file="tmp/src/org/hecl/PrintThing.java" verbose="true"/>
        <delete file="tmp/src/org/hecl/PutsCmd.java" verbose="true"/>
    </target>

    <target name="a.pre.standard" depends="a.pre.hecl">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__ALL__,${pre.extra}"/>
    </target>

    <target name="a.pre.standard-lite">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__ALL__,${pre.extra}"/>
    </target>

    <target name="a.pre.b2b-lite">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__ALL__,__B2B__,__CRC__,${pre.extra}"/>
    </target>

    <target name="a.pre.b2b-builder">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__ALL__,__BUILDER__,__CRC__,${pre.extra}"/>
    </target>

    <target name="a.pre.std" depends="a.pre.hecl">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,${pre.extra}"/>
    </target>

    <target name="a.pre.symbian" depends="a.pre.hecl">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__ALL__,__SYMBIAN__,${pre.extra}"/>
    </target>

    <target name="a.pre.j9" depends="a.pre.hecl">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__J9__,${pre.extra}"/>
    </target>

    <target name="a.pre.rim" depends="a.pre.hecl">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__RIM__,${pre.extra}"/>
    </target>

    <target name="a.pre.rim50" depends="a.pre.hecl">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__RIM__,__RIM50__,${pre.extra}"/>
    </target>

    <target name="a.pre.android" depends="a.pre.hecl-android">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__ANDROID__,${pre.extra}"/>
    </target>

    <target name="a.pre.android-offline" depends="a.pre.hecl-android-offline">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__ANDROID__,__NO_NET__,${pre.extra}"/>
    </target>

    <target name="a.pre.android-backport" depends="a.pre.hecl-android">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__ANDROID__,__BACKPORT__,${pre.extra}"/>
    </target>

    <target name="a.pre.cn1-nolog" depends="a.pre.hecl-android-offline">
        <mkdir dir="tmp/src"/>
<!--
        <wtkpreprocess srcdir="cn1-compat/src" destdir="tmp/src" version="1"
                       symbols="__CN1__,${pre.extra}"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__CN1__,__NO_NET__,${pre.extra}"/>
-->
        <wtkpreprocess srcdir="cn1-compat/src" destdir="tmp/src" version="1"
                       symbols="__CN1__,${pre.extra}"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__CN1__,__NO_NET__,${pre.extra}"/>
    </target>

    <target name="a.pre.cn1" depends="a.pre.hecl-android-offline">
        <mkdir dir="tmp/src"/>
<!--
        <wtkpreprocess srcdir="cn1-compat/src" destdir="tmp/src" version="1"
                       symbols="__CN1__,${pre.extra}"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__CN1__,__NO_NET__,${pre.extra}"/>
-->
        <wtkpreprocess srcdir="cn1-compat/src" destdir="tmp/src" version="1"
                       symbols="__CN1__,__LOG__,${pre.extra}"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__HECL__,__CN1__,__NO_NET__,__LOG__,${pre.extra}"/>
    </target>

    <target name="a.pre.cn1-emulator">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__CN1__,__LOG__,${pre.extra}"/>
        <wtkpreprocess srcdir="cn1-compat/src" destdir="tmp/src" version="1"
                       symbols="__CN1__,__LOG__,${pre.extra}"/>
    </target>

    <target name="a.pre.cn1-nb" depends="a.pre.cn1">
        <copy todir="tmp/src">
            <fileset dir="res/resources">
                <include name="datums.txt"/>
                <include name="no-map.xml"/>
                <include name="world.*"/>
                <include name="*.png"/>
                <include name="*.svg"/>
            </fileset>
            <fileset dir="res/resources/set"/>
            <fileset dir="res-extra/resources">
                <include name="*.png"/>
            </fileset>
            <fileset dir="res-lang/resources">
                <include name="language.en.res"/>
                <include name="language.es.res"/>
                <include name="language.fr.res"/>
                <include name="language.pl.res"/>
            </fileset>
        </copy>
    </target>

    <target name="a.pre.cn1-nb-nolog" depends="a.pre.cn1-nolog">
        <copy todir="tmp/src">
            <fileset dir="res/resources">
                <include name="datums.txt"/>
                <include name="no-map.xml"/>
                <include name="world.*"/>
                <include name="*.png"/>
                <include name="*.svg"/>
            </fileset>
            <fileset dir="res/resources/set"/>
            <fileset dir="res-extra/resources">
                <include name="*.png"/>
            </fileset>
            <fileset dir="res-lang/resources">
                <include name="language.en.res"/>
                <include name="language.es.res"/>
                <include name="language.fr.res"/>
                <include name="language.pl.res"/>
            </fileset>
        </copy>
    </target>

    <target name="a.pre.emulator" depends="a.pre.hecl">
        <mkdir dir="tmp/src"/>
        <wtkpreprocess srcdir="src" destdir="tmp/src" version="1"
                       symbols="__ALL__,__HECL__,__EMULATOR__,__LOG__,${pre.extra}"/>
    </target>

    <target name="compile.standard" depends="remove.symbian.src,remove.rim.src,remove.android.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.1" source="1.3"
               bootclasspathref="bootclasspath.standard"/>
    </target>

    <target name="compile.standard-lite" depends="remove.symbian.src,remove.rim.src,
                                                  remove.android.src,remove.hecl.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.1" source="1.3"
               bootclasspathref="bootclasspath.standard"/>
    </target>

    <target name="compile.std" depends="remove.nonstd.src,remove.rim.src,remove.android.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.1" source="1.3"
               bootclasspathref="bootclasspath.std"/>
    </target>

    <target name="compile.symbian" depends="remove.nonsymbian.src,remove.rim.src,remove.android.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.1" source="1.3"
               bootclasspathref="bootclasspath.symbian"/>
    </target>

    <target name="compile.rim41" depends="remove.nonrim41.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.1" source="1.3"
               bootclasspathref="bootclasspath.rim41"/>
    </target>

    <target name="compile.rim42" depends="remove.nonrim42.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               deprecation="true"
               target="1.1" source="1.3"
               bootclasspathref="bootclasspath.rim42"/>
    </target>

    <target name="compile.rim50" depends="remove.nonrim50.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               deprecation="true"
               target="1.1" source="1.3"
               bootclasspathref="bootclasspath.rim50"/>
    </target>

    <target name="compile.rim50-ng" depends="remove.nonrim50.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               deprecation="true"
               optimize="true" debug="true" debuglevel="source,lines"
               target="1.3" source="1.3"
               bootclasspathref="bootclasspath.rim50"/>
    </target>

    <target name="compile.android" depends="remove.nonandroid.src,remove.rim.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <mkdir dir="tmp/src/javax/microedition/media"/>
        <copy file="cn1-compat/src/javax/microedition/media/MediaException.java"
              todir="tmp/src/javax/microedition/media"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.5" source="1.5" debug="true" debuglevel="source,lines"
               bootclasspathref="bootclasspath.android20"/>
    </target>

    <target name="compile.android-backport" depends="remove.nonandroid.src,remove.android2.src,remove.rim.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <copy file="cn1-compat/src/javax/microedition/media/MediaException.java"
              todir="tmp/src/javax/microedition/media"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.5" source="1.5"
               bootclasspathref="bootclasspath.android16"/>
    </target>

    <target name="compile.cn1" depends="remove.nonstd.src,remove.rim.src,remove.android.src,
                                        remove.mmapi.src,remove.lapi.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac sourcepath=""
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.5" source="1.5" debug="true"
               bootclasspathref="bootclasspath.cn1">
            <compilerarg line="-Xlint:unchecked -Xmaxwarns 1000"/>
            <src path="tmp/src"/>
            <src path="cn1-compat/src"/>
        </javac>
    </target>

    <target name="compile.cn1-trunk">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac sourcepath=""
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.5" source="1.5" debug="true"
               bootclasspathref="bootclasspath.cn1-trunk">
            <!--<compilerarg line="-Xlint:unchecked -Xmaxwarns 1000"/>-->
            <compilerarg line="-Xlint:deprecation"/>
            <src path="tmp/src"/>
        </javac>
    </target>

    <target name="prepare.cn1-nb" depends="backup.cn1.src,remove.nonstd.src,
                                           remove.rim.src,remove.android.src,
                                           remove.mmapi.src,remove.lapi.src">
        <antcall target="restore.cn1.src"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/Midp2DeviceControl.java"/>
    </target>

    <target name="backup.cn1.src">
        <copy file="tmp/src/cz/kruch/track/ui/nokia/WPDeviceControl.java" todir="${temp.dir}"/>
        <copy file="tmp/src/cz/kruch/track/fun/WPPlayback.java" todir="${temp.dir}"/>
    </target>

    <target name="restore.cn1.src">
        <copy file="${temp.dir}/WPDeviceControl.java" todir="tmp/src/cz/kruch/track/ui/nokia"/>
        <copy file="${temp.dir}/WPPlayback.java" todir="tmp/src/cz/kruch/track/fun"/>
    </target>

    <target name="compile.emulator" depends="remove.symbian.src,remove.rim.src,remove.android.src,remove.nonmidp.src">
        <mkdir dir="tmp/build/classes"/>
        <mkdir dir="tmp/ant"/>
        <javac srcdir="tmp/src"
               destdir="tmp/build/classes"
               tempdir="tmp/ant"
               fork="true"
               target="1.1" source="1.3" debug="true"
               bootclasspathref="bootclasspath.emulator"/>
    </target>

    <target name="remove.nonstd.src" depends="remove.nonmidp.src,remove.android.src">
    </target>

    <target name="remove.nonmidp.src">
        <delete file="tmp/src/api/file/MotorolaFile.java"/>
        <delete file="tmp/src/api/file/Motorola1000File.java"/>
        <delete file="tmp/src/api/file/SiemensFile.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/NokiaDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/NokiaUi14DeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/MotorolaDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/Motorola2DeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/S60DeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/SiemensDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/SonyEricssonDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/SamsungDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/LgDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/WPDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/SonimDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/location/MotorolaLocationProvider.java"/>
    </target>

    <target name="remove.nonsymbian.src">
        <delete file="tmp/src/api/file/MotorolaFile.java"/>
        <delete file="tmp/src/api/file/Motorola1000File.java"/>
        <delete file="tmp/src/api/file/SiemensFile.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/MotorolaDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/Motorola2DeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/SiemensDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/SonyEricssonDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/SamsungDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/LgDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/WPDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/SonimDeviceControl.java"/>
        <delete file="tmp/src/cz/kruch/track/location/MotorolaLocationProvider.java"/>
    </target>

    <target name="remove.symbian.src">
		<delete file="tmp/src/cz/kruch/track/device/SymbianService.java"/>
		<delete file="tmp/src/cz/kruch/track/ui/nokia/S60DeviceControl.java"/>
    </target>

    <target name="remove.hecl.src">
        <delete file="tmp/src/cz/kruch/track/hecl/ControlledInterp.java"/>
        <delete file="tmp/src/cz/kruch/track/hecl/PluginManager.java"/>
    </target>

    <target name="remove.rim.src">
        <delete file="tmp/src/cz/kruch/track/ui/nokia/BlackberryDeviceControl.java"/>
        <delete file="tmp/src/api/io/SeekableInputStream.java"/>
    </target>

    <target name="remove.android.src">
        <delete file="tmp/src/api/io/RandomAccessInputStream.java"/>
        <delete file="tmp/src/cz/kruch/track/fun/AndroidCamera.java"/>
        <delete file="tmp/src/cz/kruch/track/fun/AndroidPlayback.java"/>
        <delete file="tmp/src/cz/kruch/track/location/AndroidBluetoothLocationProvider.java"/>
        <delete file="tmp/src/cz/kruch/track/location/AndroidLocationProvider.java"/>
        <delete file="tmp/src/cz/kruch/track/location/AndroidNmeaListener.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/AndroidDeviceControl.java"/>
    </target>

    <target name="remove.b2b.src">
        <delete file="tmp/src/cz/kruch/track/io/CrcInputStream.java"/>
    </target>

    <target name="remove.nonrim41.src" depends="remove.nonstd.src,remove.android.src">
        <delete file="tmp/src/api/file/Jsr75File.java"/>
        <delete file="tmp/src/cz/kruch/track/fun/Jsr234Camera.java"/>
        <delete file="tmp/src/cz/kruch/track/location/Jsr82LocationProvider.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/Midp2DeviceControl.java"/>
    </target>

    <target name="remove.nonrim42.src" depends="remove.nonstd.src,remove.android.src">
        <delete file="tmp/src/cz/kruch/track/fun/Jsr234Camera.java"/>
        <delete file="tmp/src/cz/kruch/track/ui/nokia/Midp2DeviceControl.java"/>
    </target>

    <target name="remove.nonrim50.src" depends="remove.nonstd.src,remove.android.src">
        <delete file="tmp/src/cz/kruch/track/ui/nokia/Midp2DeviceControl.java"/>
    </target>

    <target name="remove.nonandroid.src" depends="remove.nonmidp.src,remove.mmapi.src,remove.lapi.src">
        <delete file="tmp/src/cz/kruch/track/location/Jsr179LocationProvider.java"/>
        <delete dir="tmp/src/org/xmlpull"/>
    </target>

    <target name="remove.android2.src">
        <delete file="tmp/src/cz/kruch/track/location/AndroidNmeaListener.java" verbose="true"/>
        <delete file="tmp/src/cz/kruch/track/fun/AndroidCamera.java" verbose="true"/>
        <delete file="tmp/src/cz/kruch/track/sensor/ANTPlus.java" verbose="true"/>
    </target>

    <target name="remove.mmapi.src">
        <delete file="tmp/src/cz/kruch/track/fun/Jsr120Friends.java"/>
        <delete file="tmp/src/cz/kruch/track/fun/Jsr135Camera.java"/>
        <delete file="tmp/src/cz/kruch/track/fun/Jsr234Camera.java"/>
        <delete file="tmp/src/cz/kruch/track/fun/Jsr135Playback.java"/>
    </target>

    <target name="remove.lapi.src">
        <!--delete file="tmp/src/cz/kruch/track/location/SerialLocationProvider.java"/-->
        <delete file="tmp/src/cz/kruch/track/location/Jsr82LocationProvider.java"/>
        <delete file="tmp/src/cz/kruch/track/location/Jsr179OrientationProvider.java"/>
        <delete file="tmp/src/cz/kruch/track/location/O2GermanyLocationProvider.java"/>
    </target>

    <target name="remove.fileapi.src">
        <delete file="tmp/src/api/file/Jsr75File.java"/>
    </target>

    <target name="create.tmp.jad">
        <wtkjad jadfile="tmp/trekbuddy${suffix}.jad"
                config="CLDC-${wtk.cldc.version}"
                profile="MIDP-${wtk.midp.version}"
                name="${name}" 
                vendor="${vendor}"
                version="${version}">
            <attribute name="MicroEdition-Configuration" value="CLDC-${wtk.cldc.version}"/>
            <attribute name="MicroEdition-Profile" value="MIDP-${wtk.midp.version}"/>
            <attribute name="MIDlet-Data-Size" value="4096"/>
            <attribute name="MIDlet-Description" value="${description}"/>
            <attribute name="MIDlet-Info-URL" value="http://www.trekbuddy.net"/>
            <attribute name="MIDlet-Icon" value="/resources/icon.png"/>
            <attribute name="${permission.attribute}" value="javax.microedition.io.Connector.file.read,javax.microedition.io.Connector.file.write,javax.microedition.io.Connector.bluetooth.client,javax.microedition.location.Location,javax.microedition.media.control.VideoControl.getSnapshot,javax.microedition.io.Connector.sms,javax.wireless.messaging.sms.receive,javax.wireless.messaging.sms.send,javax.microedition.io.Connector.comm,javax.microedition.io.Connector.cbs,javax.wireless.messaging.cbs.receive,javax.microedition.io.Connector.socket,javax.microedition.io.PushRegistry,javax.microedition.location.Orientation,javax.microedition.io.Connector.http"/>
<!-- dangerous; don't forget to exclude it when uncommented
            <attribute name="MIDlet-Touch-Support" value="true"/>
-->
            <midlet name="${name}" class="cz.kruch.track.TrackingMIDlet" icon="/resources/icon.png"/>
        </wtkjad>
        <fixcrlf srcdir="tmp" eol="crlf" eof="remove" encoding="UTF-8" includes="trekbuddy${suffix}.jad"/>
    </target>

    <target name="a.pack" depends="create.tmp.jad">
        <wtkpackage jarfile="tmp/trekbuddy${suffix}.jar"
                    jadfile="tmp/trekbuddy${suffix}.jad"
                    config="CLDC-${wtk.cldc.version}"
                    profile="MIDP-${wtk.midp.version}">
            <fileset dir="tmp/build/classes"/>
            <fileset dir="res">
                <include name="**/datums.txt"/>
                <include name="**/no-map.xml"/>
                <include name="**/world.*"/>
                <include name="**/set/**"/>
                <include name="**/*.png"/>
                <include name="**/*.svg"/>
            </fileset>
            <fileset dir="res-extra">
                <include name="**/*.png"/>
            </fileset>
            <fileset dir="res-lang">
                <include name="resources/language.en.res"/>
                <include name="resources/language.es.res"/>
                <include name="resources/language.fr.res"/>
                <include name="resources/language.pl.res"/>
            </fileset>
            <manifest>
                <attribute name="Built-By" value="kruhc@seznam.cz"/>
                <attribute name="Content-Folder" value="Applications"/>
                <!--<attribute name="Nokia-Scalable-Icon-MIDlet-1" value="/resources/icon.svg"/>-->
                <attribute name="Nokia-MIDlet-Category" value="Application"/>
                <attribute name="Nokia-MIDlet-No-Exit" value="true"/>
                <attribute name="LGE-MIDlet-Display-Nav-Keypad" value="no"/>
                <attribute name="LGE-MIDlet-Display-Indicator" value="HIDE"/>
                <attribute name="LGE-MIDlet-Allowed-background" value="YES"/>
                <attribute name="MVM-Pause-Background" value="false"/>
                <attribute name="MVM-BGM-Support" value="true"/>
                <attribute name="FlipInsensitive" value="True"/>
            </manifest>
        </wtkpackage>
    </target>

    <target name="lite.pack" depends="create.tmp.jad">
        <wtkpackage jarfile="tmp/trekbuddy${suffix}.jar"
                    jadfile="tmp/trekbuddy${suffix}.jad"
                    config="CLDC-${wtk.cldc.version}"
                    profile="MIDP-${wtk.midp.version}">
            <fileset dir="tmp/build/classes"/>
            <fileset dir="res">
                <include name="**/datums.txt"/>
                <include name="**/no-map.xml"/>
                <include name="**/*.png"/>
                <exclude name="**/set/*.png"/>
            </fileset>
            <fileset dir="res-extra">
                <include name="**/*.png"/>
            </fileset>
            <fileset dir="res-lang">
                <include name="resources/language.en.res"/>
                <include name="resources/language.es.res"/>
                <include name="resources/language.fr.res"/>
                <include name="resources/language.pl.res"/>
            </fileset>
            <manifest>
                <attribute name="Built-By" value="kruhc@seznam.cz"/>
                <attribute name="Content-Folder" value="Applications"/>
                <!--<attribute name="Nokia-Scalable-Icon-MIDlet-1" value="/resources/icon.svg"/>-->
                <attribute name="Nokia-MIDlet-Category" value="Application"/>
                <attribute name="Nokia-MIDlet-No-Exit" value="true"/>
                <attribute name="LGE-MIDlet-Display-Nav-Keypad" value="no"/>
                <attribute name="LGE-MIDlet-Display-Indicator" value="HIDE"/>
                <attribute name="LGE-MIDlet-Allowed-background" value="YES"/>
                <attribute name="MVM-Pause-Background" value="false"/>
                <attribute name="MVM-BGM-Support" value="true"/>
                <attribute name="FlipInsensitive" value="True"/>
            </manifest>
        </wtkpackage>
    </target>

    <target name="j9.pack" depends="create.tmp.jad">
        <wtkpackage jarfile="tmp/trekbuddy${suffix}.jar"
                    jadfile="tmp/trekbuddy${suffix}.jad"
                    config="CLDC-${wtk.cldc.version}"
                    profile="MIDP-${wtk.midp.version}">
            <fileset dir="tmp/build/classes"/>
            <fileset dir="res-J9">
            </fileset>
            <fileset dir="res">
                <include name="**/datums.txt"/>
                <include name="**/no-map.xml"/>
                <include name="**/world.*"/>
                <include name="**/set/**"/>
            </fileset>
            <fileset dir="res-extra">
                <include name="**/*.png"/>
            </fileset>
            <fileset dir="res-lang">
                <include name="resources/language.en.res"/>
                <include name="resources/language.es.res"/>
                <include name="resources/language.fr.res"/>
                <include name="resources/language.pl.res"/>
            </fileset>
            <manifest>
                <attribute name="Built-By" value="kruhc@seznam.cz"/>
                <attribute name="Content-Folder" value="Applications"/>
            </manifest>
        </wtkpackage>
    </target>

    <target name="rim.pack" depends="create.tmp.jad">
        <echo message="Using RIM-specific resource folder: ${resource.folder}"/>
        <wtkpackage jarfile="tmp/trekbuddy${suffix}.jar"
                    jadfile="tmp/trekbuddy${suffix}.jad"
                    config="CLDC-${wtk.cldc.version}"
                    profile="MIDP-${wtk.midp.version}">
            <fileset dir="tmp/build/classes"/>
            <fileset dir="${resource.folder}">
            </fileset>
            <fileset dir="res">
                <include name="**/datums.txt"/>
                <include name="**/no-map.xml"/>
                <include name="**/world.*"/>
                <include name="**/set/**"/>
            </fileset>
            <fileset dir="res-extra">
                <include name="**/*.png"/>
            </fileset>
            <fileset dir="res-lang">
                <include name="resources/language.en.res"/>
                <include name="resources/language.es.res"/>
                <include name="resources/language.fr.res"/>
                <include name="resources/language.pl.res"/>
            </fileset>
            <manifest>
                <attribute name="Built-By" value="kruhc@seznam.cz"/>
                <attribute name="Content-Folder" value="Applications"/>
            </manifest>
        </wtkpackage>
    </target>

    <target name="symbian.pack" depends="create.tmp.jad">
        <wtkpackage jarfile="tmp/trekbuddy${suffix}.jar"
                    jadfile="tmp/trekbuddy${suffix}.jad"
                    config="CLDC-${wtk.cldc.version}"
                    profile="MIDP-${wtk.midp.version}">
            <fileset dir="tmp/build/classes"/>
            <fileset dir="res">
                <include name="**/datums.txt"/>
                <include name="**/no-map.xml"/>
                <include name="**/world.*"/>
                <include name="**/set/**"/>
                <include name="**/*.png"/>
                <include name="**/*.svg"/>
            </fileset>
            <fileset dir="res-extra">
                <include name="**/*.png"/>
            </fileset>
            <fileset dir="res-lang">
                <include name="resources/language.en.res"/>
                <include name="resources/language.es.res"/>
                <include name="resources/language.fr.res"/>
                <include name="resources/language.pl.res"/>
                <include name="resources/language.cs.res"/>
            </fileset>
            <manifest>
                <attribute name="Built-By" value="kruhc@seznam.cz"/>
                <attribute name="Content-Folder" value="Applications"/>
                <attribute name="Nokia-Scalable-Icon-MIDlet-1" value="/resources/icon.svg"/>
                <attribute name="Nokia-MIDlet-Category" value="Application"/>
                <attribute name="Nokia-MIDlet-No-Exit" value="true"/>
                <attribute name="FlipInsensitive" value="True"/>
            </manifest>
        </wtkpackage>
    </target>

    <target name="android.pack" depends="create.tmp.jad">
        <wtkpackage jarfile="tmp/trekbuddy${suffix}.jar"
                    jadfile="tmp/trekbuddy${suffix}.jad"
                    config="CLDC-${wtk.cldc.version}"
                    profile="MIDP-${wtk.midp.version}">
            <fileset dir="tmp/build/classes"/>
            <fileset dir="res">
                <include name="**/datums.txt"/>
                <include name="**/no-map.xml"/>
                <include name="**/*.png"/>
                <include name="**/world.*"/>
                <include name="**/set/**"/>
                <exclude name="**/icon.png"/>
            </fileset>
            <fileset dir="res-extra">
                <include name="**/*.png"/>
            </fileset>
            <fileset dir="res-lang">
                <include name="resources/language.en.res"/>
                <include name="resources/language.es.res"/>
                <include name="resources/language.fr.res"/>
                <include name="resources/language.pl.res"/>
                <include name="resources/language.cs.res"/>
            </fileset>
            <manifest>
                <attribute name="Built-By" value="kruhc@seznam.cz"/>
            </manifest>
        </wtkpackage>
    </target>

    <target name="cn1.pack" depends="create.tmp.jad">
        <wtkpackage jarfile="tmp/trekbuddy${suffix}.jar"
                    jadfile="tmp/trekbuddy${suffix}.jad"
                    config="CLDC-${wtk.cldc.version}"
                    profile="MIDP-${wtk.midp.version}">
            <fileset dir="tmp/build/classes"/>
            <fileset dir="res/resources">
                <include name="datums.txt"/>
                <include name="no-map.xml"/>
                <include name="world.*"/>
<!--
                <include name="**/set/**"/>
-->
                <include name="*.png"/>
                <include name="*.svg"/>
            </fileset>
            <fileset dir="res/resources/set"/>
            <fileset dir="res-extra/resources">
                <include name="*.png"/>
            </fileset>
            <fileset dir="res-lang/resources">
                <include name="language.en.res"/>
                <include name="language.es.res"/>
                <include name="language.fr.res"/>
                <include name="language.pl.res"/>
            </fileset>
            <fileset dir="z:\repository\cn1\Themes">
                <include name="winTheme.res"/>
            </fileset>
            <manifest>
                <attribute name="Built-By" value="kruhc@seznam.cz"/>
                <attribute name="Content-Folder" value="Applications"/>
                <!--<attribute name="Nokia-Scalable-Icon-MIDlet-1" value="/resources/icon.svg"/>-->
                <attribute name="Nokia-MIDlet-Category" value="Application"/>
                <attribute name="Nokia-MIDlet-No-Exit" value="true"/>
                <attribute name="LGE-MIDlet-Display-Nav-Keypad" value="no"/>
                <attribute name="LGE-MIDlet-Display-Indicator" value="HIDE"/>
                <attribute name="LGE-MIDlet-Allowed-background" value="YES"/>
                <attribute name="MVM-Pause-Background" value="false"/>
                <attribute name="MVM-BGM-Support" value="true"/>
                <attribute name="FlipInsensitive" value="True"/>
            </manifest>
        </wtkpackage>
    </target>

    <target name="cn1-trunk.pack">
        <!-- just update localization files that may have changed... -->
        <copy todir="c:\Users\pour\Documents\Visual Studio 2013\Projects\TrackingApp\TrackingApp\res">
            <fileset dir="res-lang/resources">
                <include name="language.en.res"/>
                <include name="language.es.res"/>
                <include name="language.fr.res"/>
                <include name="language.pl.res"/>
                <include name="language.cs.res"/>
            </fileset>
        </copy>
    </target>

    <target name="wp.pack">
        <unzip src="${cn1.repository}\dist\CodenameOne.jar" dest="tmp/build/classes"/>
        <jar jarfile="tmp/trekbuddy${suffix}.jar">
            <fileset dir="tmp/build/classes"/>
        </jar>
    </target>

    <target name="wp.repack">
        <delete includeemptydirs="true">
            <fileset dir="tmp/build/classes"/>
        </delete>
        <unzip src="tmp/trekbuddy${suffix}-obfuscated.jar" dest="tmp/build/classes"/>
<!--
        <delete includeemptydirs="true" >
            <fileset dir="tmp/build/classes" includes="CN1Resource.res"/>
        </delete>
-->
        <jar jarfile="tmp/CodenameOne-shrinked.jar">
            <fileset dir="tmp/build/classes">
                <include name="com/codename1/**/*"/>
            </fileset>
        </jar>
        <jar jarfile="tmp/trekbuddy${suffix}-shrinked.jar">
            <fileset dir="tmp/build/classes">
                <exclude name="com/codename1/**/*"/>
                <exclude name="CN1Resource.res"/>
            </fileset>
        </jar>
    </target>

    <target name="obfuscate3">
	    <java jar="${proguard3.home}\lib\proguard.jar" fork="true">
            <arg value="-injars tmp/trekbuddy${suffix}.jar"/>
            <arg value="-outjars tmp/trekbuddy${suffix}-obfuscated.jar"/>
            <arg value="-libraryjars ${libraryjars}"/>
            <arg value="-dontusemixedcaseclassnames"/>
            <arg value="-dontskipnonpubliclibraryclasses"/>
            <arg value="-defaultpackage ''"/>
            <arg value="-overloadaggressively"/>
            <arg value="-allowaccessmodification"/>
            <arg value="-keep class * implements javax.microedition.midlet.MIDlet"/>
            <arg value="-keepnames class cz.** extends java.lang.Exception"/>
            <arg value="-keepnames class api.** extends java.lang.Exception"/>
            <arg value="-keepnames class org.** extends java.lang.Exception"/>
            <arg value="-whyareyoukeeping class api.io.BufferedOutputStream"/>
            <arg value="-whyareyoukeeping class net.trekbuddy.midlet.IRuntime"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.FileInput"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.LoaderIO"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.J2NCalibration"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.io.CrcInputStream"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.util.Logger"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.ControlledInterp"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.PluginManager"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.KeyCheckTimerTask"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.nokia.NokiaUi14DeviceControl"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.nokia.S60DeviceControl"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.device.NokiaApSelector"/>
            <arg value="-printmapping dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.map"/>
            <arg value="-printseeds"/>
            <arg value="-printusage dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.dco"/>
            <arg value="-verbose"/>
        </java>
    </target> 

    <target name="obfuscate3.rim">
	    <java jar="${proguard3.home}\lib\proguard.jar" fork="true">
            <arg value="-injars tmp/trekbuddy${suffix}.jar"/>
            <arg value="-outjars tmp/trekbuddy${suffix}-obfuscated.jar"/>
            <arg value="-libraryjars '${libraryjars}'"/>
            <arg value="-dontskipnonpubliclibraryclasses"/>
            <arg value="-dontusemixedcaseclassnames"/>
            <arg value="-defaultpackage ''"/>
<!-- cannot be used with RIM
            <arg value="-overloadaggressively"/>
            <arg value="-allowaccessmodification"/>
-->
            <arg value="-keep class * implements javax.microedition.midlet.MIDlet"/>
            <arg value="-keepnames class api.io.SeekableInputStream"/>
            <arg value="-keepnames class cz.** extends java.lang.Exception"/>
            <arg value="-keepnames class api.** extends java.lang.Exception"/>
            <arg value="-keepnames class org.** extends java.lang.Exception"/>
            <arg value="-whyareyoukeeping class api.io.BufferedOutputStream"/>
            <arg value="-whyareyoukeeping class net.trekbuddy.midlet.IRuntime"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.FileInput"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.LoaderIO"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.io.CrcInputStream"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.util.Logger"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.ControlledInterp"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.PluginManager"/>
            <arg value="-printmapping dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.map"/>
            <arg value="-printseeds"/>
            <arg value="-verbose"/>
        </java>
    </target>

    <target name="obfuscate4">
        <java jar="${proguard4.home}\lib\proguard.jar" fork="true">
            <jvmarg value="-Dmaximum.inlined.code.length=4"/>
            <jvmarg value="-Doptimize.conservatively=true"/>
            <arg value="-injars tmp/trekbuddy${suffix}.jar"/>
            <arg value="-outjars tmp/trekbuddy${suffix}-obfuscated.jar"/>
            <arg value="-libraryjars ${libraryjars}"/>
            <arg value="-dontpreverify"/> <!-- preverified elsewhere; this is 4.x flag -->
            <arg value="-dontusemixedcaseclassnames"/>
            <arg value="-dontskipnonpubliclibraryclasses"/>
            <arg value="-repackageclasses ''"/>
            <arg value="-overloadaggressively"/>
            <arg value="-allowaccessmodification"/>
            <arg value="-keep class * implements javax.microedition.midlet.MIDlet"/>
            <arg value="-keepnames class cz.** extends java.lang.Exception"/>
            <arg value="-keepnames class api.** extends java.lang.Exception"/>
            <arg value="-keepnames class org.** extends java.lang.Exception"/>
            <arg value="-whyareyoukeeping class api.io.BufferedOutputStream"/>
            <arg value="-whyareyoukeeping class net.trekbuddy.midlet.IRuntime"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.FileInput"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.LoaderIO"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.io.CrcInputStream"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.util.Logger"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.ControlledInterp"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.PluginManager"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.KeyCheckTimerTask"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.nokia.NokiaUi14DeviceControl"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.nokia.S60DeviceControl"/>
            <arg value="-printmapping dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.map"/>
            <arg value="-printseeds"/>
            <arg value="-printusage dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.dco"/>
            <arg value="-verbose"/>
        </java>
    </target>

    <target name="obfuscate4.rim">
	    <java jar="${proguard4.home}\lib\proguard.jar" fork="true">
            <jvmarg value="-Dmaximum.inlined.code.length=4"/>
            <jvmarg value="-Doptimize.conservatively=true"/>
            <arg value="-injars tmp/trekbuddy${suffix}.jar"/>
            <arg value="-outjars tmp/trekbuddy${suffix}-obfuscated.jar"/>
            <arg value="-libraryjars '${libraryjars}'"/>
            <arg value="-dontpreverify"/> <!-- preverified with RIM SDK; this is 4.x flag -->
            <arg value="-dontskipnonpubliclibraryclasses"/>
            <arg value="-dontusemixedcaseclassnames"/>
            <arg value="-repackageclasses ''"/>
<!-- cannot be used with RIM
            <arg value="-overloadaggressively"/>
            <arg value="-allowaccessmodification"/>
-->
            <arg value="-keep class * implements javax.microedition.midlet.MIDlet"/>
            <arg value="-keepnames class cz.** extends java.lang.Exception"/>
            <arg value="-keepnames class api.** extends java.lang.Exception"/>
            <arg value="-keepnames class org.** extends java.lang.Exception"/>
            <arg value="-whyareyoukeeping class api.io.BufferedOutputStream"/>
            <arg value="-whyareyoukeeping class net.trekbuddy.midlet.IRuntime"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.FileInput"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.LoaderIO"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.io.CrcInputStream"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.util.Logger"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.ControlledInterp"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.PluginManager"/>
            <arg value="-printmapping dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.map"/>
            <arg value="-printseeds"/>
            <arg value="-verbose"/>
        </java>
    </target>

    <target name="obfuscate4.android">
	    <java jar="${proguard4.home}\lib\proguard.jar" fork="true">
            <jvmarg value="-Dmaximum.inlined.code.length=4"/>
            <jvmarg value="-Doptimize.conservatively=true"/>
            <arg value="-injars tmp/trekbuddy${suffix}.jar"/>
            <arg value="-outjars tmp/trekbuddy${suffix}-obfuscated.jar"/>
            <arg value="-libraryjars ${libraryjars}"/>
            <arg value="-dontpreverify"/> <!-- not preverified; this is 4.x flag -->
            <arg value="-optimizations !code/simplification/arithmetic"/> <!-- dalvik 1.0/1.5 issue workaround -->
            <arg value="-dontusemixedcaseclassnames"/>
            <arg value="-dontskipnonpubliclibraryclasses"/>
            <arg value="-repackageclasses ''"/>
            <arg value="-allowaccessmodification"/>
<!-- leaving this optimization to dx? "Dalvik VM also can't handle aggressive overloading" (ProGuard Manual)
            <arg value="-overloadaggressively"/>
-->
            <arg value="-renamesourcefileattribute TrekBuddy"/>
            <arg value="-keepattributes SourceFile,LineNumberTable"/>
            <arg value="-keep class * implements javax.microedition.midlet.MIDlet"/>
            <arg value="-keepnames class api.io.RandomAccessInputStream"/>
            <arg value="-keepnames class net.trekbuddy.midlet.Runtime"/>
            <arg value="-keepnames class net.trekbuddy.midlet.IRuntime"/>
            <arg value="-keepnames class com.dsi.ant.**"/>
            <arg value="-keepnames class cz.** extends java.lang.Exception"/>
            <arg value="-keepnames class api.** extends java.lang.Exception"/>
            <arg value="-keepnames class org.** extends java.lang.Exception"/>
            <arg value="-whyareyoukeeping class api.io.BufferedOutputStream"/>
            <arg value="-whyareyoukeeping class net.trekbuddy.midlet.IRuntime"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.FileInput"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.io.CrcInputStream"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.NoMapLoader"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.SmartList"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.util.Logger"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.ControlledInterp"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.PluginManager"/>
            <arg value="-printmapping dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.map"/>
            <arg value="-printseeds"/>
            <arg value="-printusage dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.dco"/>
            <arg value="-verbose"/>
        </java>
    </target>

    <target name="obfuscate4.cn1">
        <java jar="${proguard4.home}\lib\proguard.jar" fork="true">
            <jvmarg value="-Dmaximum.inlined.code.length=4"/>
            <jvmarg value="-Doptimize.conservatively=true"/>
            <arg value="-injars tmp/trekbuddy${suffix}.jar"/>
            <arg value="-outjars tmp/trekbuddy${suffix}-obfuscated.jar"/>
            <arg value="-libraryjars ${libraryjars}"/>
            <arg value="-dontpreverify"/> <!-- not preverified; this is 4.x flag -->
            <arg value="-dontoptimize"/>
            <arg value="-dontusemixedcaseclassnames"/>
            <arg value="-dontskipnonpubliclibraryclasses"/>
            <arg value="-useuniqueclassmembernames"/>
<!-- could be dangerous
            <arg value="-repackageclasses ''"/>
            <arg value="-overloadaggressively"/>
            <arg value="-allowaccessmodification"/>
-->
            <arg value="-keepnames class *"/>
            <arg value="-keep class * implements javax.microedition.midlet.MIDlet"/>
            <arg value="-keep class net.trekbuddy.midlet.TrackingApp { *; }"/>
            <arg value="-keepnames class cz.** extends java.lang.Exception"/>
            <arg value="-keepnames class api.** extends java.lang.Exception"/>
            <arg value="-keepnames class org.** extends java.lang.Exception"/>
            <arg value="-whyareyoukeeping class api.io.BufferedOutputStream"/>
            <arg value="-whyareyoukeeping class net.trekbuddy.midlet.IRuntime"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.FileInput"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.LoaderIO"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.io.CrcInputStream"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.util.Logger"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.ControlledInterp"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.PluginManager"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.nokia.NokiaUi14DeviceControl"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.nokia.S60DeviceControl"/>
            <arg value="-printmapping dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.map"/>
            <arg value="-printseeds"/>
            <arg value="-printusage dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.dco"/>
            <arg value="-verbose"/>
        </java>
    </target>

    <target name="obfuscate5.wp">
        <java jar="${proguard5.home}\lib\proguard.jar" fork="true">
            <arg value="-injars tmp/trekbuddy${suffix}.jar"/>
            <arg value="-outjars tmp/trekbuddy${suffix}-obfuscated.jar"/>
            <arg value="-libraryjars ${cn1.repository}\CLDC11.jar;${cn1.repository}\..\Factory\dist\Factory.jar"/>
            <arg value="-dontpreverify"/> <!-- not preverified; this is 4.x flag -->
            <arg value="-dontoptimize"/>
            <arg value="-dontobfuscate"/>
            <arg value="-keepnames class *"/>
            <arg value="-keep class * implements javax.microedition.midlet.MIDlet"/>
            <arg value="-keep class net.trekbuddy.midlet.TrackingApp { *; }"/>
            <arg value="-keep class javax.*"/>
            <arg value="-keep class api.*"/>
            <arg value="-keep class com.ice.*"/>
            <arg value="-keep class cz.*"/>
            <arg value="-keep class net.*"/>
            <arg value="-keep class org.kxml2.*"/>
            <arg value="-keep class org.xmlpull.*"/>
            <arg value="-keep class com.codename1.location.Location { *; }"/>
            <arg value="-keep class com.codename1.location.LocationManager { *; }"/>
            <arg value="-keep class com.codename1.location.LocationListener { *; }"/>
            <arg value="-keep class com.codename1.io.FileSystemStorage { *; }"/>
            <arg value="-keep class com.codename1.io.Log {
                public static final int *;
                public void set*(...);
                public void closeWriter();
            }"/>
            <arg value="-keep class com.codename1.ui.Display { public void init(); }"/>
            <arg value="-keep class com.codename1.ui.Font { *; }"/>
            <arg value="-keep class com.codename1.ui.Image { *; }"/>
            <arg value="-keep class com.codename1.ui.IndexedImage { *; }"/>
            <arg value="-keep class com.codename1.ui.RGBImage { *; }"/>
            <arg value="-keep class com.codename1.io.Util { public void setImplementation(...); }"/>
            <arg value="-keep class com.codename1.impl.CodenameOneImplementation {
                public abstract &lt;methods&gt;;
                public void flashBacklight(int);
                public boolean shouldWriteUTFAsGetBytes();
                public void draw*(...);
                public void fill*(...);
            }"/>
            <arg value="-printusage dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.dco"/>
            <arg value="-verbose"/>
        </java>
    </target>

    <target name="obfuscate5">
        <java jar="${proguard5.home}\lib\proguard.jar" fork="true">
            <jvmarg value="-Dmaximum.inlined.code.length=4"/>
            <jvmarg value="-Doptimize.conservatively=true"/>
            <arg value="-injars tmp/trekbuddy${suffix}.jar"/>
            <arg value="-outjars tmp/trekbuddy${suffix}-obfuscated.jar"/>
            <arg value="-libraryjars ${libraryjars}"/>
            <arg value="-dontpreverify"/> <!-- preverified elsewhere; this is 4.x flag -->
            <arg value="-dontusemixedcaseclassnames"/>
            <arg value="-dontskipnonpubliclibraryclasses"/>
            <arg value="-repackageclasses ''"/>
            <arg value="-overloadaggressively"/>
            <arg value="-allowaccessmodification"/>
            <arg value="-keep class * implements javax.microedition.midlet.MIDlet"/>
            <arg value="-keepnames class cz.** extends java.lang.Exception"/>
            <arg value="-keepnames class api.** extends java.lang.Exception"/>
            <arg value="-keepnames class org.** extends java.lang.Exception"/>
            <arg value="-whyareyoukeeping class api.io.BufferedOutputStream"/>
            <arg value="-whyareyoukeeping class net.trekbuddy.midlet.IRuntime"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.FileInput"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.maps.io.LoaderIO"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.io.CrcInputStream"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.util.Logger"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.ControlledInterp"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.hecl.PluginManager"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.KeyCheckTimerTask"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.nokia.NokiaUi14DeviceControl"/>
            <arg value="-whyareyoukeeping class cz.kruch.track.ui.nokia.S60DeviceControl"/>
            <arg value="-printmapping dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.map"/>
            <arg value="-printseeds"/>
            <arg value="-printusage dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.dco"/>
            <arg value="-verbose"/>
        </java>
    </target>

    <target name="preverify">
	    <exec executable="${wtk.home}\bin\preverify1.1.exe">
            <arg line="-classpath ${classpath.preverify} -d tmp/preverified tmp/trekbuddy${suffix}-obfuscated.jar"/>
	    </exec>
    </target>

    <target name="rim.preverify">
        <echo>Using ${classpath.preverify} for preverification...</echo>
        <exec executable="${rim.home}\bin\preverify.exe">
            <arg line="-classpath '${classpath.preverify}' -d tmp/preverified tmp/trekbuddy${suffix}-obfuscated.jar"/>
        </exec>
    </target>

    <target name="dist">
        <delete>
            <fileset dir="dist/${vendor.dir}/${dist.dir}" includes="**/*.jar,**/*.jad"/>
        </delete>
        <copy file="tmp/preverified/trekbuddy${suffix}-obfuscated.jar"
              tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jar"
              verbose="true"/>
        <wtkjad jadfile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jad"
                jarfile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jar"
                config="CLDC-${wtk.cldc.version}"
                profile="MIDP-${wtk.midp.version}"
                name="${name}"
                vendor="${vendor}"
                version="${version}">
            <midlet name="${name}" class="cz.kruch.track.TrackingMIDlet" icon="/resources/icon.png"/>
            <attribute name="MicroEdition-Configuration" value="CLDC-${wtk.cldc.version}"/>
            <attribute name="MicroEdition-Profile" value="MIDP-${wtk.midp.version}"/>
            <attribute name="MIDlet-Data-Size" value="4096"/>
            <attribute name="MIDlet-Description" value="${description}"/>
            <attribute name="MIDlet-Info-URL" value="http://www.trekbuddy.net"/>
            <attribute name="MIDlet-Icon" value="/resources/icon.png"/>
            <attribute name="${permission.attribute}" value="javax.microedition.io.Connector.file.read,javax.microedition.io.Connector.file.write,javax.microedition.io.Connector.bluetooth.client,javax.microedition.location.Location,javax.microedition.media.control.VideoControl.getSnapshot,javax.microedition.io.Connector.sms,javax.wireless.messaging.sms.receive,javax.wireless.messaging.sms.send,javax.microedition.io.Connector.comm,javax.microedition.io.Connector.cbs,javax.wireless.messaging.cbs.receive,javax.microedition.io.Connector.socket,javax.microedition.io.PushRegistry,javax.microedition.location.Orientation,javax.microedition.io.Connector.http"/>
            <attribute name="Content-Folder" value="Applications"/>
            <attribute name="Nokia-Scalable-Icon-MIDlet-1" value="/resources/icon.svg"/>
            <attribute name="Nokia-MIDlet-Category" value="Application"/>
            <attribute name="Nokia-MIDlet-No-Exit" value="true"/>
            <attribute name="Nokia-MIDlet-On-Screen-Keypad" value="no"/>
        </wtkjad>
        <fixcrlf srcdir="dist/${vendor.dir}/${dist.dir}"
                 eol="crlf" eof="remove" encoding="UTF-8" 
                 includes="trekbuddy${suffix}.jad"/>
    </target>

    <target name="dist.symbian">
        <delete>
            <fileset dir="dist/${vendor.dir}/${dist.dir}" includes="**/*.jar,**/*.jad"/>
        </delete>
        <copy file="tmp/preverified/trekbuddy${suffix}-obfuscated.jar"
              tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jar"
              verbose="true"/>
        <wtkjad jadfile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jad"
                jarfile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jar"
                config="CLDC-${wtk.cldc.version}"
                profile="MIDP-${wtk.midp.version}"
                name="${name}"
                vendor="${vendor}"
                version="${version}">
            <midlet name="${name}" class="cz.kruch.track.TrackingMIDlet" icon="/resources/icon.png"/>
            <attribute name="MicroEdition-Configuration" value="CLDC-${wtk.cldc.version}"/>
            <attribute name="MicroEdition-Profile" value="MIDP-${wtk.midp.version}"/>
            <attribute name="MIDlet-Data-Size" value="4096"/>
            <attribute name="MIDlet-Description" value="${description}"/>
            <attribute name="MIDlet-Info-URL" value="http://www.trekbuddy.net"/>
            <attribute name="MIDlet-Icon" value="/resources/icon.png"/>
            <attribute name="${permission.attribute}" value="javax.microedition.io.Connector.file.read,javax.microedition.io.Connector.file.write,javax.microedition.io.Connector.bluetooth.client,javax.microedition.location.Location,javax.microedition.media.control.VideoControl.getSnapshot,javax.microedition.io.Connector.sms,javax.wireless.messaging.sms.receive,javax.wireless.messaging.sms.send,javax.microedition.io.Connector.comm,javax.microedition.io.Connector.cbs,javax.wireless.messaging.cbs.receive,javax.microedition.io.Connector.socket,javax.microedition.io.PushRegistry,javax.microedition.location.Orientation,javax.microedition.io.Connector.http"/>
            <attribute name="Content-Folder" value="Applications"/>
            <attribute name="Nokia-Scalable-Icon-MIDlet-1" value="/resources/icon.svg"/>
            <attribute name="Nokia-MIDlet-Category" value="Application"/>
            <attribute name="Nokia-MIDlet-No-Exit" value="true"/>
            <attribute name="Nokia-MIDlet-On-Screen-Keypad" value="no"/>
            <attribute name="Nokia-MIDlet-S60-Selection-Key-Compatibility" value="true"/>
        </wtkjad>
        <fixcrlf srcdir="dist/${vendor.dir}/${dist.dir}"
                 eol="crlf" eof="remove" encoding="UTF-8"
                 includes="trekbuddy${suffix}.jad"/>
    </target>

    <target name="dist.android">
        <delete>
            <fileset dir="dist/${vendor.dir}/${dist.dir}" includes="**/*.jar,**/*.jad"/>
        </delete>
        <copy file="tmp/preverified/trekbuddy${suffix}-obfuscated.jar"
              tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jar"
              verbose="true"/>
        <wtkjad jadfile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jad"
                jarfile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jar"
                config="CLDC-${wtk.cldc.version}"
                profile="MIDP-${wtk.midp.version}"
                name="${name}"
                vendor="${vendor}"
                version="${version}">
            <midlet name="${name}" class="cz.kruch.track.TrackingMIDlet" icon="/resources/icon.png"/>
            <attribute name="MicroEdition-Configuration" value="CLDC-${wtk.cldc.version}"/>
            <attribute name="MicroEdition-Profile" value="MIDP-${wtk.midp.version}"/>
        </wtkjad>
        <fixcrlf srcdir="dist/${vendor.dir}/${dist.dir}"
                 eol="crlf" eof="remove" encoding="UTF-8"
                 includes="trekbuddy${suffix}.jad"/>
    </target>

    <target name="sign.and.update">
        <echo message="certificate expired"/>
        <copy file="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jad"
              tofile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}-expired.jad"/>
        <antcall target="sign.and.update.2013"/>
    </target>

    <target name="sign.and.update.2013">
        <property name="jarfile" value="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jar"/>
        <property name="jadfile" value="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}-expired.jad"/>
        <java jar="${wtk.home}\bin\JadTool.jar" fork="true">
            <arg line="-addcert -certnum 1 -alias 'trekbuddy2013' -keystore keystores\trekbuddy2013.jks -inputjad ${jadfile} -outputjad ${jadfile}"/>
        </java>
        <java jar="${wtk.home}\bin\JadTool.jar" fork="true">
            <arg line="-addcert -certnum 2 -alias 'trekbuddy2013' -keystore keystores\trekbuddy2013.jks -inputjad ${jadfile} -outputjad ${jadfile}"/>
        </java>
        <java jar="${wtk.home}\bin\JadTool.jar" fork="true">
            <arg line="-addcert -certnum 3 -alias 'trekbuddy2013' -keystore keystores\trekbuddy2013.jks -inputjad ${jadfile} -outputjad ${jadfile}"/>
        </java>
        <java jar="${wtk.home}\bin\JadTool.jar" fork="true">
            <arg line="-addcert -certnum 4 -alias 'trekbuddy2013' -keystore keystores\trekbuddy2013.jks -inputjad ${jadfile} -outputjad ${jadfile}"/>
        </java>

        <!-- Thawte Premium Server CA w/ SN: 1 -->
        <!--echo file="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jad" append="true">MIDlet-Certificate-1-4: MIIDJzCCApCgAwIBAgIBATANBgkqhkiG9w0BAQQFADCBzjELMAkGA1UEBhMCWkExFTATBgNVBAgTDFdlc3Rlcm4gQ2FwZTESMBAGA1UEBxMJQ2FwZSBUb3duMR0wGwYDVQQKExRUaGF3dGUgQ29uc3VsdGluZyBjYzEoMCYGA1UECxMfQ2VydGlmaWNhdGlvbiBTZXJ2aWNlcyBEaXZpc2lvbjEhMB8GA1UEAxMYVGhhd3RlIFByZW1pdW0gU2VydmVyIENBMSgwJgYJKoZIhvcNAQkBFhlwcmVtaXVtLXNlcnZlckB0aGF3dGUuY29tMB4XDTk2MDgwMTAwMDAwMFoXDTIwMTIzMTIzNTk1OVowgc4xCzAJBgNVBAYTAlpBMRUwEwYDVQQIEwxXZXN0ZXJuIENhcGUxEjAQBgNVBAcTCUNhcGUgVG93bjEdMBsGA1UEChMUVGhhd3RlIENvbnN1bHRpbmcgY2MxKDAmBgNVBAsTH0NlcnRpZmljYXRpb24gU2VydmljZXMgRGl2aXNpb24xITAfBgNVBAMTGFRoYXd0ZSBQcmVtaXVtIFNlcnZlciBDQTEoMCYGCSqGSIb3DQEJARYZcHJlbWl1bS1zZXJ2ZXJAdGhhd3RlLmNvbTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA0jY2aovXwlue2oFBYo847kkEVdbQ7xwblRZH7xhINTpS9CtqBo87L+pW46+GjZ4X9560ZXUCTe/LCaIhUdib0GfQug2SBhRz1JPLlyoAnFxODLz6FVL88kRu2hFKbgifLy3j+ao6hnO2RlNYyIkFvYMRuHM/qgeN9EJN50CdHDcCAwEAAaMTMBEwDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQQFAAOBgQAmSCwWwlj66BZ0DKqqX1Q/8tfJeGBeXm43YyJ3Nn6yF8Q0ufUIhfzJATj/Tb7yFkJD57taRvvBxhEf8UqwKEbJw8RCfbz6q1lu1bdRiBHjpIUZa4JMpAwSremkrj/xw0llmozFyD4lt5SZu5IycQfwhl7tUCemDaYj+bvLpgcUQg==</echo-->
        <!-- Thawte Premium Server CA w/ SN: 36... -->
        <!--echo file="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.jad" append="true">MIDlet-Certificate-1-4: MIIDNjCCAp+gAwIBAgIQNhIilsXjOKUgodJfTNcJVDANBgkqhkiG9w0BAQUFADCBzjELMAkGA1UEBhMCWkExFTATBgNVBAgTDFdlc3Rlcm4gQ2FwZTESMBAGA1UEBxMJQ2FwZSBUb3duMR0wGwYDVQQKExRUaGF3dGUgQ29uc3VsdGluZyBjYzEoMCYGA1UECxMfQ2VydGlmaWNhdGlvbiBTZXJ2aWNlcyBEaXZpc2lvbjEhMB8GA1UEAxMYVGhhd3RlIFByZW1pdW0gU2VydmVyIENBMSgwJgYJKoZIhvcNAQkBFhlwcmVtaXVtLXNlcnZlckB0aGF3dGUuY29tMB4XDTk2MDgwMTAwMDAwMFoXDTIxMDEwMTIzNTk1OVowgc4xCzAJBgNVBAYTAlpBMRUwEwYDVQQIEwxXZXN0ZXJuIENhcGUxEjAQBgNVBAcTCUNhcGUgVG93bjEdMBsGA1UEChMUVGhhd3RlIENvbnN1bHRpbmcgY2MxKDAmBgNVBAsTH0NlcnRpZmljYXRpb24gU2VydmljZXMgRGl2aXNpb24xITAfBgNVBAMTGFRoYXd0ZSBQcmVtaXVtIFNlcnZlciBDQTEoMCYGCSqGSIb3DQEJARYZcHJlbWl1bS1zZXJ2ZXJAdGhhd3RlLmNvbTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA0jY2aovXwlue2oFBYo847kkEVdbQ7xwblRZH7xhINTpS9CtqBo87L+pW46+GjZ4X9560ZXUCTe/LCaIhUdib0GfQug2SBhRz1JPLlyoAnFxODLz6FVL88kRu2hFKbgifLy3j+ao6hnO2RlNYyIkFvYMRuHM/qgeN9EJN50CdHDcCAwEAAaMTMBEwDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQUFAAOBgQBlkKyID1bZ5jA01CbH0FDxkt5r1DmICSLGpmODA/eZd9iy5Ri4XWPz1HP7bJyZePFLeH0ZJMMrAoT4vCLZiiLXoPxx7JGHIPG47LHlVYCsPVLIOQ7C8MAFT9aCdYy9X9LcdpoFEsmvcsPcJX6kTY4XpeCHf+GaWuFg3GQjPEIuTQ==</echo-->

        <java jar="${wtk.home}\bin\JadTool.jar" fork="true">
            <arg line="-addjarsig -alias 'trekbuddy2013' -keystore keystores\trekbuddy2013.jks -keypass changeit -jarfile ${jarfile} -inputjad ${jadfile} -outputjad ${jadfile}"/>
        </java>

        <fixcrlf srcdir="dist/${vendor.dir}/${dist.dir}"
                 eol="crlf" eof="remove" encoding="UTF-8"
                 includes="trekbuddy${suffix}-expired.jad"/>
        <java jar="${wtk.home}\bin\JadTool.jar" fork="true">
            <arg line="-showcert -all -inputjad ${jadfile}"/>
        </java>
    </target>

    <target name="rim.rapc">
        <echo>Using rim.home=${rim.home}</echo>
        <exec dir="${basedir}\dist\${vendor.dir}\${dist.dir}" executable="${rim.home}\bin\rapc.exe">
            <arg line="import='${rim.home}\lib\net_rim_api.jar' codename=trekbuddy${suffix} -quiet -midlet ${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.jad ${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.jar"/>
        </exec>
        <copy file="${basedir}\trekbuddy.alx"
              tofile="${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.alx"/>
        <replace file="${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.alx" token="@SUFFIX@" value="${suffix}"/>
        <replace file="${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.alx" token="@BBVERSION@" value="${rim.bb.version}"/>
        <replace file="${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.alx" token="@DESCRIPTION@" value="${description}"/>
        <replace file="${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.alx" token="@VERSION@" value="${version}.0.${build_version}"/>
        <replace file="${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.alx" token="@VENDOR@" value="${vendor}"/>
        <replace file="${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.alx" token="@MODULES@" value="trekbuddy${suffix}.cod"/>
    </target>

    <target name="rim.sign">
        <echo>Signing rim.home=${rim42.home}</echo>
        <java fork="yes" jar="${rim42.home}/bin/SignatureTool.jar" failonerror="true">
           <arg line="-a -c -s -p changeit ${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.cod"/>
        </java>
    </target>

    <target name="rim.zip">
        <zip destfile="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.zip">
            <fileset dir="dist/${vendor.dir}/${dist.dir}"
                     includes="trekbuddy${suffix}.cod,trekbuddy${suffix}.alx"/>
        </zip>
    </target>

    <target name="rim.ota">
        <property name="rim.cod.file" value="dist/${vendor.dir}/${dist.dir}/trekbuddy${suffix}.cod"/>
        <property name="rim.ota.dir" value="dist/${vendor.dir}/${dist.dir}/ota"/>
        <mkdir dir="${rim.ota.dir}"/>
        <script language="javascript"><![CDATA[
          self.getProject().setNewProperty("rim.cod.modified", (new Number(new java.io.File(self.getProject().getProperty("rim.cod.file")).lastModified()) / 1000).toFixed());
        ]]></script>
        <wtkjad jadfile="${rim.ota.dir}/trekbuddy${suffix}.jad"
                config="CLDC-${wtk.cldc.version}"
                profile="MIDP-${wtk.midp.version}"
                name="${name}"
                vendor="${vendor}"
                version="${version}">
            <attribute name="MicroEdition-Configuration" value="CLDC-${wtk.cldc.version}"/>
            <attribute name="MicroEdition-Profile" value="MIDP-${wtk.midp.version}"/>
            <attribute name="MIDlet-Data-Size" value="4096"/>
            <attribute name="MIDlet-Description" value="${description}"/>
            <attribute name="MIDlet-Info-URL" value="http://www.trekbuddy.net"/>
            <attribute name="MIDlet-Icon" value="/resources/icon.png"/>
            <attribute name="${permission.attribute}" value="javax.microedition.io.Connector.file.read,javax.microedition.io.Connector.file.write,javax.microedition.io.Connector.bluetooth.client,javax.microedition.location.Location,javax.microedition.media.control.VideoControl.getSnapshot,javax.microedition.io.Connector.sms,javax.wireless.messaging.sms.receive,javax.wireless.messaging.sms.send,javax.microedition.io.Connector.comm,javax.microedition.io.Connector.cbs,javax.wireless.messaging.cbs.receive,javax.microedition.io.Connector.socket,javax.microedition.io.PushRegistry,javax.microedition.location.Orientation,javax.microedition.io.Connector.http"/>
            <attribute name="Content-Folder" value="Applications"/>
            <attribute name="RIM-COD-Creation-Time" value="${rim.cod.modified}"/>
            <attribute name="RIM-COD-Module-Name" value="trekbuddy${suffix}"/>
            <attribute name="RIM-COD-Module-Dependencies" value="${rim.cod.dependencies}"/>
        </wtkjad>
        <fixcrlf srcdir="${rim.ota.dir}"
                 eol="crlf" eof="remove"
                 includes="trekbuddy${suffix}.jad"/>
        <unzip src="${rim.cod.file}" dest="${rim.ota.dir}"/>
        <otaJad moduleName="trekbuddy${suffix}" jad="${rim.ota.dir}/trekbuddy${suffix}.jad">
            <fileset dir="${rim.ota.dir}" includes="**/*.cod"/>
        </otaJad>
        <fixcrlf srcdir="${rim.ota.dir}"
                 eol="crlf" eof="remove"
                 includes="trekbuddy${suffix}.jad"/>
        <copy file="${basedir}\trekbuddy.alx"
              tofile="${rim.ota.dir}\trekbuddy${suffix}.alx"/>
        <replace file="${rim.ota.dir}\trekbuddy${suffix}.alx" token="@SUFFIX@" value="${suffix}"/>
        <replace file="${rim.ota.dir}\trekbuddy${suffix}.alx" token="@BBVERSION@" value="${rim.bb.version}"/>
        <replace file="${rim.ota.dir}\trekbuddy${suffix}.alx" token="@DESCRIPTION@" value="${description}"/>
        <replace file="${rim.ota.dir}\trekbuddy${suffix}.alx" token="@VERSION@" value="${version}.0.${build_version}"/>
        <replace file="${rim.ota.dir}\trekbuddy${suffix}.alx" token="@VENDOR@" value="${vendor}"/>
        <replace file="${rim.ota.dir}\trekbuddy${suffix}.alx" token="@MODULES@" value="${rim.cod.modules}"/>
        <zip destfile="${rim.ota.dir}\trekbuddy${suffix}.zip"
             basedir="${rim.ota.dir}"
             includes="**.cod,**.alx"/>
    </target>

    <target name="jad2prc">
        <echo>Using garnet.home=${garnet.home}</echo>
        <exec dir="${basedir}" newenvironment="true" executable="${garnet.home}\bin\jad2prc.exe">
            <env key="JAVA_HOME" value="${garnet.home}"/>
            <arg line="-keystore ${basedir}\keystores\j2me-manufacturer2011.keystore -vmOption -DLcduiHighResolution=true -vmOption -Xmx4M -o ${basedir}\dist\${vendor.dir}\palm\trekbuddy.prc ${basedir}\dist\${vendor.dir}\${dist.dir}\trekbuddy${suffix}.jad"/>
        </exec>
    </target>

</project>
